# pr_11
# Практическая работа 11. Производственный SQL 
# Цель работы
• Оптимизация использования базы данных, позволяющая
выполнять больше запросов с меньшими ресурсами.

• Внедрение индексного и последовательного сканирования.

• Интерпретировать вывод EXPLAIN ANALYZE.

• Понимать преимущества использования объединений вместо
других функций.

• Внедрение триггеров в ответ на определенные события.

• Создавать и использовать функции для создания более
сложных и эффективных запросов.

• Выявление длительных запросов и их завершение.
# Выполнение работы
# Практика 1
Используем команду EXPLAIN, чтобы вернуть план
запроса для выбора всех доступных записей в таблице
клиентов.
```
explain select * from customers;
```
Получили начальные затраты 0.00, сообщаемую стоимость 1540.00, общую стоимость выполнения запроса 50000, общее количество строк, доступных для возврата 140

Ограничим количество возвращемых записей до 15
```
explain select * from customers limit 15;
```
Получили начальные затраты 0.00, сообщаемую стоимость 0.46, общую стоимость выполнения запроса 15, общее количество строк, доступных для возврата 140

Создадим план запроса, выбрав все строки, где клиенты живут в пределах широты 30 и 40 градусов.
```
explain select * from customers where latitude > '30' and latitude < '40';
```
Получили начальные затраты 0.00, сообщаемую стоимость 1790.00, общую стоимость выполнения запроса 26183,  общее количество строк, доступных для возврата 140

Таким образом при ограничении количества возвращаемых записей сообщаемая стоимость уменьшилась, общая стоимость запроса уменьшилась. 
# Практика 2
Используем команды EXPLAIN и ANALYZE, чтобы профилировать план запроса для поиска всех записей с IPадресом 18.131.58.65.
```
explain analyze select * from customers where ip_address='18.131.58.65';
```
Получаем планирование запроса = 0.208 ms, выполнение запроса = 8.797 ms, начальные затраты 0.00, сообщаемую стоимость 1665.00, общую стоимость выполнения запроса 1, общее количество строк, доступных для возврата 140

Создаем общий индекс на основе столбца IP-адреса
```
CREATE INDEX ix_ipaddress ON customers(ip_address);
```
Повторяем запрос 1 шага
```
explain analyze select * from customers;
```
Получаем планирование запроса = 2.008 ms, выполнение запроса = 0.158 ms, начальные затраты 0.29, сообщаемую стоимость 8.31, общую стоимость выполнения запроса 1, общее количество строк, доступных для возврата 140

Создаем более подробный индекс
```
create index ix_ipaddress_1 on customers (ip_address)
where ip_address='18.131.58.65';
```
Повторяем запрос 1 шага
```
explain analyze select * from customers where ip_address='18.131.58.65';
```
Получаем планирование запроса = 5.791 ms, выполнение запроса = 0.091 ms, начальные затраты 0.12, сообщаемую стоимость 8.14, общую стоимость выполнения запроса 1, общее количество строк, доступных для возврата 140

Таким образом при выполнении запроса после создания индекса время выполнения запроса сокращается, чем подробнее индекс, тем быстрее выполняется запрос

Используем команды EXPLAIN и ANALYZE для профилирования плана запроса для поиска всех записей с суффиксом Jr.
```
explain analyze select * from customers where suffix like '%Jr%';
```
Получаем планирование запроса = 0.753 ms, выполнение запроса = 9.931 ms, начальные затраты 0.00, сообщаемую стоимость 1665.00, общую стоимость выполнения запроса 80, общее количество строк, доступных для возврата 140

Создаем общий индекс
```
create index ix_suffix on customers (suffix) ;
```
Повторно запускаем запрос шага 6
```
explain analyze select * from customers where suffix like '%Jr%';
```
Получаем планирование запроса = 10.739 ms, выполнение запроса = 6.001 ms, начальные затраты 0.00, сообщаемую стоимость 1665.00, общую стоимость выполнения запроса 80, общее количество строк, доступных для возврата 140
# Практика 3
Используйте команды EXPLAIN и ANALYZE, чтобы определить время и стоимость планирования, а также время и стоимость выполнения для выбора всех строк, где тема электронной почты — «Шокирующая экономия на праздничных покупках электрических самокатов» в первом запросе и «Черная пятница». Зеленые автомобили." во втором запросе.
```
explain analyze select * from emails 
where email_subject like 'Shocking Holiday Saving On Electric Scooters';
```
Получаем планирование запроса = 0.186 ms, выполнение запроса = 66.880 ms, начальные затраты 1000.00, сообщаемую стоимость 8650.01, общую стоимость выполнения запроса 1, общее количество строк, доступных для возврата 79
```
explain analyze select * from emails
where email_subject like 'Black Friday. Green Cars.';
```
Получаем планирование запроса = 0.106 ms, выполнение запроса = 47.649 ms, начальные затраты 0.00, сообщаемую стоимость 10698.98, общую стоимость выполнения запроса 43098, общее количество строк, доступных для возврата 79

Создаем хеш-сканирование в столбце email_subject.
```
CREATE INDEX ix_emailsubject ON emails USING HASH(email_subject);
```
Повторяем 1 шаг
```
explain analyze select * from emails 
where email_subject like 'Shocking Holiday Saving On Electric Scooters';
```
Получаем планирование запроса = 1.458 ms, выполнение запроса = 0.040 ms, начальные затраты 0.00, сообщаемую стоимость 8.02, общую стоимость выполнения запроса 1, общее количество строк, доступных для возврата 79
```
explain analyze select * from emails
where email_subject like 'Black Friday. Green Cars.';
```
Получаем планирование запроса = 0.143 ms, выполнение запроса = 16.691 ms, начальные затраты 0.00, 
сообщаемую стоимость 1379.24, общую стоимость выполнения запроса 43098, общее количество строк, доступных для возврата 79

Таким образом при сканировании хэша уменьшается время на выполнение запроса
Создаем хэш-сканирование столбца customer_id
```
create index ix_customerid on customers using HASH(customer_id);
```
Используем EXPLAIN и ANALYZE, чтобы оценить, сколько времени потребуется,
чтобы выбрать все строки со значением customer_id больше 100.
```
explain analyze select * from customers
where customer_id > 100;
```
Получаем планирование запроса = 1.860 ms, выполнение запроса = 3.133 ms, начальные затраты 0.00, сообщаемую стоимость 1665.00, общую стоимость выполнения запроса 49899, общее количество строк, доступных для возврата 140
# Вывод
Научились использовать индексное и последовательное сканирование, интерпретировать вывод EXPLAIN ANALYZE, создавать и использовать функции для создания более сложных и эффективных запросов.

